<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚·ã‚¹ãƒ†ãƒ è¨­å®š | ãƒ¯ãƒ³ã‚¿ãƒƒãƒç®¡ç†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Hiragino Sans", "Noto Sans CJK JP", sans-serif;
            background: #fafafa;
            min-height: 100vh;
        }
.container {
            max-width: 640px;
            margin: 40px auto;
            padding: 0 20px;
        }

        .section {
            background: white;
            border-radius: 8px;
            padding: 32px;
            margin-bottom: 24px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .section-title {
            font-size: 18px;
            font-weight: 700;
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid #f0f0f0;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            border-bottom: 1px solid #f5f5f5;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            font-size: 14px;
            color: #666;
            font-weight: 600;
        }

        .info-value {
            font-size: 14px;
            color: #333;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            background: #e3f2fd;
            color: #1976d2;
        }

        .link-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            background: #f9fafb;
            border-radius: 8px;
            margin-bottom: 12px;
            text-decoration: none;
            color: #333;
            transition: all 0.2s;
            border: 1px solid #e5e7eb;
        }

        .link-item:hover {
            background: #f0f0f0;
            border-color: #1a1a1a;
        }

        .link-item-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .link-icon {
            font-size: 20px;
        }

        .link-label {
            font-size: 14px;
            font-weight: 600;
        }

        .link-arrow {
            color: #999;
            font-size: 18px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            width: 100%;
            margin-bottom: 12px;
        }

        .btn-primary {
            background: white;
            border: 1px solid #e0e0e0;
            color: #333;
        }

        .btn-primary:hover {
            background: #fafafa;
        }

        .btn-danger {
            background: #dc2626;
            color: white;
        }

        .btn-danger:hover {
            background: #b91c1c;
        }
.stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }

        .stat-card {
            background: #f9fafb;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: #333;
        }

        .stat-unit {
            font-size: 14px;
            color: #999;
            margin-left: 4px;
        }

        @media (max-width: 768px) {
.container {
                padding: 0 16px;
            }

            .section {
                padding: 24px 20px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <script src="demo-mode.js"></script>
    <script src="unified-header.js"></script>
    <meta name="theme-color" content="#1a1a1a">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="icon-192.png">
</head>
<body>
    <!-- çµ±ä¸€ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div id="unified-header-mount"></div>

    <div class="container">
        <!-- ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±ï¼ˆå…¨ãƒ­ãƒ¼ãƒ«å…±é€šï¼‰ -->
        <div class="section">
            <div class="section-title"> çµ±è¨ˆæƒ…å ±</div>
            
            <div class="stats-grid" id="statsGrid">
                <!-- JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
            </div>
        </div>

        <!-- è©³ç´°çµ±è¨ˆãƒ»ç›£è¦–ï¼ˆsystem_adminå°‚ç”¨ï¼‰ -->
        <div class="section" id="advancedStats" style="display:none;">
            <div class="section-title"> è©³ç´°çµ±è¨ˆãƒ»ç›£è¦–</div>
            
            <!-- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä½¿ç”¨é‡ -->
            <div style="margin-bottom: 32px;">
                <div style="font-weight: 600; margin-bottom: 16px; color: #333;"> ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä½¿ç”¨é‡</div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">ç·ä½¿ç”¨å®¹é‡</div>
                        <div class="stat-value" id="totalStorage">0<span class="stat-unit">KB</span></div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">ä¼šç¤¾ãƒ‡ãƒ¼ã‚¿</div>
                        <div class="stat-value" id="companyStorage">0<span class="stat-unit">KB</span></div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">äº‹æ¥­æ‰€ãƒ‡ãƒ¼ã‚¿</div>
                        <div class="stat-value" id="officeStorage">0<span class="stat-unit">KB</span></div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿</div>
                        <div class="stat-value" id="accountStorage">0<span class="stat-unit">KB</span></div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">é€šå ±ãƒ‡ãƒ¼ã‚¿</div>
                        <div class="stat-value" id="reportStorage">0<span class="stat-unit">KB</span></div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">ç›£æŸ»ãƒ­ã‚°</div>
                        <div class="stat-value" id="auditStorage">0<span class="stat-unit">KB</span></div>
                    </div>
                </div>
                <div id="storageWarning" style="display:none; background: #fff8e1; color: #f57c00; padding: 12px; border-radius: 6px; margin-top: 12px; font-size: 14px;">
                     LocalStorageã®ä½¿ç”¨å®¹é‡ãŒå¤šããªã£ã¦ã„ã¾ã™ã€‚å¤ã„ãƒ‡ãƒ¼ã‚¿ã®å‰Šé™¤ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚
                </div>
            </div>

            <!-- ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•° -->
            <div style="margin-bottom: 32px;">
                <div style="font-weight: 600; margin-bottom: 16px; color: #333;">ğŸ‘¥ ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°</div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">ä»Šæ—¥</div>
                        <div class="stat-value" id="todayActiveUsers">0<span class="stat-unit">äºº</span></div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">ä»Šé€±</div>
                        <div class="stat-value" id="weekActiveUsers">0<span class="stat-unit">äºº</span></div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">ä»Šæœˆï¼ˆMAUï¼‰</div>
                        <div class="stat-value" id="monthActiveUsers">0<span class="stat-unit">äºº</span></div>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="window.location.href='audit-log.html'" style="margin-top: 12px;">
                     ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥ãƒ­ã‚°ã‚¤ãƒ³å±¥æ­´ã‚’è¦‹ã‚‹
                </button>
            </div>

            <!-- é€šå ±ä»¶æ•°æ¨ç§» -->
            <div style="margin-bottom: 32px;">
                <div style="font-weight: 600; margin-bottom: 16px; color: #333;">ğŸ“ˆ é€šå ±ä»¶æ•°æ¨ç§»</div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">ä»Šæ—¥</div>
                        <div class="stat-value" id="todayReports">0<span class="stat-unit">ä»¶</span></div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">ä»Šé€±</div>
                        <div class="stat-value" id="weekReports">0<span class="stat-unit">ä»¶</span></div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">ä»Šæœˆ</div>
                        <div class="stat-value" id="monthReports">0<span class="stat-unit">ä»¶</span></div>
                    </div>
                </div>
                <div style="margin-top: 16px; padding: 16px; background: #f8f9fa; border-radius: 8px;">
                    <div style="font-size: 14px; font-weight: 600; margin-bottom: 12px;">ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥é€šå ±æ•°</div>
                    <div id="categoryBreakdown"></div>
                </div>
            </div>

        </div>

        <!-- äº‹æ¥­æ‰€æƒ…å ±ï¼ˆoffice_adminå°‚ç”¨ï¼‰ -->
        <div class="section" id="officeInfo" style="display:none;">
            <div class="section-title">ğŸª äº‹æ¥­æ‰€æƒ…å ±</div>
            
            <div class="info-row">
                <div class="info-label">äº‹æ¥­æ‰€å</div>
                <div class="info-value" id="officeNameDisplay">-</div>
            </div>

            <div class="info-row">
                <div class="info-label">äº‹æ¥­æ‰€ã‚³ãƒ¼ãƒ‰</div>
                <div class="info-value">
                    <span class="badge" id="officeCodeDisplay">-</span>
                </div>
            </div>

            <div class="info-row">
                <div class="info-label">æ‰€å±ä¼šç¤¾</div>
                <div class="info-value" id="officeCompanyDisplay">-</div>
            </div>

            <div class="info-row">
                <div class="info-label">ä½æ‰€</div>
                <div class="info-value" id="officeAddressDisplay">-</div>
            </div>

            <div class="info-row">
                <div class="info-label">é›»è©±ç•ªå·</div>
                <div class="info-value" id="officePhoneDisplay">-</div>
            </div>

            <div style="margin-top: 16px; padding: 12px; background: #fafafa; border-radius: 6px; font-size: 13px; color: #666;">
                â„¹ï¸ äº‹æ¥­æ‰€æƒ…å ±ã®ç·¨é›†ã¯æœ¬ç¤¾ç®¡ç†è€…ãŒè¡Œã„ã¾ã™ã€‚å¤‰æ›´ãŒå¿…è¦ãªå ´åˆã¯æœ¬ç¤¾ç®¡ç†è€…ã«é€£çµ¡ã—ã¦ãã ã•ã„ã€‚
            </div>
        </div>

        <!-- ç›£æŸ»ãƒ­ã‚°ã¸ã®ãƒªãƒ³ã‚¯ï¼ˆcompany_admin / office_adminï¼‰ -->
        <div class="section" id="auditLogSection" style="display:none;">
            <div class="section-title"> æ“ä½œå±¥æ­´ãƒ»ç›£æŸ»ãƒ­ã‚°</div>
            
            <div class="info-row">
                <div class="info-label">æ“ä½œå±¥æ­´ã®ç¢ºèª</div>
                <div class="info-value">
                    <a href="audit-log.html" class="btn btn-primary" style="display: inline-block; text-decoration: none;">
                         ç›£æŸ»ãƒ­ã‚°ã‚’è¦‹ã‚‹
                    </a>
                    <div style="font-size: 12px; color: #666; margin-top: 8px;">
                        ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆãƒ»ç·¨é›†ãƒ»å‰Šé™¤ãªã©ã®æ“ä½œå±¥æ­´ã‚’ç¢ºèªã§ãã¾ã™
                    </div>
                </div>
            </div>
        </div>

        <!-- ä¼šç¤¾è¨­å®šï¼ˆcompany_adminä»¥ä¸Šï¼‰ -->
        <div class="section" id="companySettings" style="display:none;">
            <div class="section-title">ğŸ¢ ä¼šç¤¾è¨­å®š</div>
            
            <!-- ä¼šç¤¾ãƒ­ã‚´ -->
            <div class="info-row">
                <div class="info-label">ä¼šç¤¾ãƒ­ã‚´</div>
                <div class="info-value">
                    <div style="display: flex; align-items: center; gap: 16px;">
                        <div id="currentLogo" style="width: 60px; height: 60px; background: #1a1a1a; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-size: 24px; font-weight: bold;">
                            T
                        </div>
                        <div>
                            <input type="file" id="logoUpload" accept="image/*" style="display: none;" onchange="handleLogoUpload(event)">
                            <button class="btn btn-primary" onclick="document.getElementById('logoUpload').click()">
                                ğŸ“· ãƒ­ã‚´ã‚’å¤‰æ›´
                            </button>
                            <div style="font-size: 12px; color: #666; margin-top: 4px;">
                                æ¨å¥¨: æ­£æ–¹å½¢ã€PNGå½¢å¼ã€200x200pxä»¥ä¸Š
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ä¼šç¤¾å -->
            <div class="info-row">
                <div class="info-label">ä¼šç¤¾å</div>
                <div class="info-value" id="companyNameDisplay">ã‚¿ãƒ ã‚¸æ ªå¼ä¼šç¤¾</div>
            </div>

            <!-- ä¼šç¤¾ã‚³ãƒ¼ãƒ‰ -->
            <div class="info-row">
                <div class="info-label">ä¼šç¤¾ã‚³ãƒ¼ãƒ‰</div>
                <div class="info-value">
                    <span class="badge" id="companyCodeDisplay">TAMJ</span>
                </div>
            </div>
        </div>

        <!-- é€šå ±ã‚«ãƒ†ã‚´ãƒªãƒ¼è¨­å®šï¼ˆcompany_adminä»¥ä¸Šï¼‰ -->
        <div class="section" id="categorySettings" style="display:none;">
            <div class="section-title"> é€šå ±ã‚«ãƒ†ã‚´ãƒªãƒ¼è¨­å®š</div>
            
            <div style="margin-bottom: 16px; padding: 12px; background: #fafafa; border-radius: 6px; font-size: 14px; color: #666;">
                ğŸ’¡ æ¨™æº–ã‚«ãƒ†ã‚´ãƒªãƒ¼ã¯æ®‹ã—ã¤ã¤ã€ä¼šç¤¾ç‹¬è‡ªã®ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’è¿½åŠ ã§ãã¾ã™
            </div>

            <!-- æ¨™æº–ã‚«ãƒ†ã‚´ãƒªãƒ¼ -->
            <div style="margin-bottom: 20px;">
                <div style="font-weight: 600; margin-bottom: 8px; color: #333;">æ¨™æº–ã‚«ãƒ†ã‚´ãƒªãƒ¼ï¼ˆå›ºå®šï¼‰</div>
                <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                    <span class="badge" style="background: #e3f2fd; color: #1976d2;">å¸æ¥­è€…</span>
                    <span class="badge" style="background: #e8f5e9; color: #388e3c;">ãƒ“ãƒ«ãƒ¡ãƒ³æ¥­è€…</span>
                    <span class="badge" style="background: #fff8e1; color: #f57c00;">ç¦ç¥‰ç”¨å…·æ¥­è€…</span>
                    <span class="badge" style="background: #ffebee; color: #c62828;">ç·Šæ€¥</span>
                </div>
            </div>

            <!-- ã‚«ã‚¹ã‚¿ãƒ ã‚«ãƒ†ã‚´ãƒªãƒ¼ -->
            <div style="margin-bottom: 20px;">
                <div style="font-weight: 600; margin-bottom: 8px; color: #333;">ã‚«ã‚¹ã‚¿ãƒ ã‚«ãƒ†ã‚´ãƒªãƒ¼</div>
                <div id="customCategoriesList" style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 12px;">
                    <!-- ã‚«ã‚¹ã‚¿ãƒ ã‚«ãƒ†ã‚´ãƒªãƒ¼ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
                </div>
                <button class="btn btn-primary" onclick="addCustomCategory()">
                    â• ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’è¿½åŠ 
                </button>
            </div>
        </div>

        <!-- ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ˆç®¡ç†è€…ã®ã¿ï¼‰ -->
        <div class="section" id="dataExportSection" style="display:none;">
            <div class="section-title">ğŸ“¥ ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</div>
            
            <div style="margin-bottom: 16px; padding: 12px; background: #fafafa; border-radius: 6px; font-size: 13px; color: #666;">
                â„¹ï¸ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚CSVå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã™ã€‚
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: flex; align-items: center; padding: 12px; border: 1px solid #e0e0e0; border-radius: 6px; cursor: pointer; margin-bottom: 8px;">
                    <input type="checkbox" id="exportAccounts" style="margin-right: 12px; width: 18px; height: 18px;">
                    <div>
                        <div style="font-weight: 600;">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒã‚¹ã‚¿</div>
                        <div style="font-size: 12px; color: #666;">ãƒ¦ãƒ¼ã‚¶ãƒ¼IDãƒ»åå‰ãƒ»ãƒ­ãƒ¼ãƒ«ç­‰</div>
                    </div>
                </label>
                
                <label style="display: flex; align-items: center; padding: 12px; border: 1px solid #e0e0e0; border-radius: 6px; cursor: pointer; margin-bottom: 8px;" id="exportOfficesLabel">
                    <input type="checkbox" id="exportOffices" style="margin-right: 12px; width: 18px; height: 18px;">
                    <div>
                        <div style="font-weight: 600;">äº‹æ¥­æ‰€ãƒã‚¹ã‚¿</div>
                        <div style="font-size: 12px; color: #666;">äº‹æ¥­æ‰€åãƒ»ä½æ‰€ãƒ»é€£çµ¡å…ˆç­‰</div>
                    </div>
                </label>
                
                <label style="display: flex; align-items: center; padding: 12px; border: 1px solid #e0e0e0; border-radius: 6px; cursor: pointer; margin-bottom: 8px;" id="exportPartnersLabel">
                    <input type="checkbox" id="exportPartners" style="margin-right: 12px; width: 18px; height: 18px;">
                    <div>
                        <div style="font-weight: 600;">æ¥­è€…ãƒã‚¹ã‚¿</div>
                        <div style="font-size: 12px; color: #666;">æ¥­è€…åãƒ»ã‚«ãƒ†ã‚´ãƒªãƒ¼ãƒ»é€£çµ¡å…ˆç­‰</div>
                    </div>
                </label>
                
                <label style="display: flex; align-items: center; padding: 12px; border: 1px solid #e0e0e0; border-radius: 6px; cursor: pointer; margin-bottom: 8px;">
                    <input type="checkbox" id="exportItems" style="margin-right: 12px; width: 18px; height: 18px;">
                    <div>
                        <div style="font-weight: 600;">å•†å“ãƒã‚¹ã‚¿</div>
                        <div style="font-size: 12px; color: #666;">å•†å“åãƒ»ãƒ¡ãƒ¼ã‚«ãƒ¼ãƒ»å‹ç•ªãƒ»æ‹…å½“æ¥­è€…ç­‰</div>
                    </div>
                </label>
                
                <label style="display: flex; align-items: center; padding: 12px; border: 1px solid #e0e0e0; border-radius: 6px; cursor: pointer; margin-bottom: 8px;">
                    <input type="checkbox" id="exportReports" style="margin-right: 12px; width: 18px; height: 18px;">
                    <div>
                        <div style="font-weight: 600;">é€šå ±å±¥æ­´</div>
                        <div style="font-size: 12px; color: #666;">é€šå ±æ—¥æ™‚ãƒ»ã‚«ãƒ†ã‚´ãƒªãƒ¼ãƒ»çŠ¶æ³ãƒ»å¯¾å¿œçŠ¶æ³ç­‰</div>
                    </div>
                </label>
                
                <label style="display: flex; align-items: center; padding: 12px; border: 1px solid #e0e0e0; border-radius: 6px; cursor: pointer;" id="exportAuditLabel">
                    <input type="checkbox" id="exportAudit" style="margin-right: 12px; width: 18px; height: 18px;">
                    <div>
                        <div style="font-weight: 600;">ç›£æŸ»ãƒ­ã‚°</div>
                        <div style="font-size: 12px; color: #666;">æ“ä½œå±¥æ­´ãƒ»æ—¥æ™‚ãƒ»å®Ÿè¡Œè€…ç­‰</div>
                    </div>
                </label>
            </div>
            
            <button class="btn btn-primary" onclick="executeExport()" style="width: 100%;">
                ğŸ“¥ é¸æŠã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
            </button>
        </div>

        <!-- ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ï¼ˆsystem_adminã®ã¿ï¼‰ -->
        <div class="section" id="dataDeleteSection" style="display:none;">
            <div class="section-title">ğŸ—‘ï¸ ãƒ‡ãƒ¼ã‚¿ç®¡ç†</div>
            
            <div style="margin-bottom: 16px; padding: 12px; background: #fff3cd; border: 1px solid #ffc107; border-radius: 6px; font-size: 13px; color: #856404;">
                 è­¦å‘Š: ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚å…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ãŒå®Œå…¨ã«å‰Šé™¤ã•ã‚Œã¾ã™ã€‚
            </div>
            
            <button class="btn btn-danger" onclick="clearAllData()">
                ğŸ—‘ï¸ å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤
            </button>
        </div>

        <!-- ãƒªãƒ³ã‚¯ -->
        <div class="section">
            <div class="section-title">ğŸ“„ è¦ç´„ãƒ»ãƒãƒªã‚·ãƒ¼</div>
            
            <a href="terms.html" class="link-item">
                <div class="link-item-left">
                    <span class="link-icon">ğŸ“œ</span>
                    <span class="link-label">åˆ©ç”¨è¦ç´„</span>
                </div>
                <span class="link-arrow">â†’</span>
            </a>

            <a href="privacy.html" class="link-item">
                <div class="link-item-left">
                    <span class="link-icon">ğŸ”’</span>
                    <span class="link-label">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</span>
                </div>
                <span class="link-arrow">â†’</span>
            </a>
        </div>

        <!-- ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ -->
        <div class="section">
            <button class="btn btn-logout" onclick="logout()">
                ğŸšª ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
            </button>
        </div>
    </div>

    <script>
        // ãƒ­ã‚°ã‚¤ãƒ³ãƒã‚§ãƒƒã‚¯
        const currentUser = JSON.parse(sessionStorage.getItem('currentUser'));
        if (!currentUser) {
            window.location.href = 'login.html';
        } else if (currentUser.role !== 'company_admin' && currentUser.role !== 'office_admin' && currentUser.role !== 'system_admin') {
            alert('ã“ã®ç”»é¢ã¯ç®¡ç†è€…ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚');
            window.location.href = 'master-top.html';
        }

        // æˆ»ã‚‹æ©Ÿèƒ½
        // æˆ»ã‚‹ï¼ˆãƒ­ãƒ¼ãƒ«ã«å¿œã˜ãŸãƒ›ãƒ¼ãƒ ã«é·ç§»ï¼‰
        function goBack() {
            try {
                const currentUser = JSON.parse(sessionStorage.getItem('currentUser'));
                
                if (!currentUser || !currentUser.role) {
                    window.location.href = 'login.html';
                    return;
                }

                // ãƒ­ãƒ¼ãƒ«åˆ¥ã®ãƒ›ãƒ¼ãƒ ç”»é¢
                const homePages = {
                    'system_admin': 'system-admin.html',
                    'company_admin': 'master-top.html',
                    'office_admin': 'master-top.html',
                    'staff': 'report.html',
                    'contractor': 'contractor-dashboard.html'
                };

                const homePage = homePages[currentUser.role] || 'master-top.html';
                window.location.href = homePage;
            } catch (e) {
                console.error('goBack error:', e);
                window.location.href = 'master-top.html';
            }
        }

        // çµ±è¨ˆæƒ…å ±ã‚’è¡¨ç¤º
        function loadStats() {
            try {
                // ä¼šç¤¾æ•°
                const companies = JSON.parse(localStorage.getItem('companies') || '[]');
                document.getElementById('companyCount').innerHTML = companies.length + '<span class="stat-unit">ä»¶</span>';

                // ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæ•°
                const accounts = JSON.parse(localStorage.getItem('accounts') || '[]');
                document.getElementById('accountCount').innerHTML = accounts.length + '<span class="stat-unit">ä»¶</span>';

                // äº‹æ¥­æ‰€æ•°
                const offices = JSON.parse(localStorage.getItem('offices') || '[]');
                document.getElementById('officeCount').innerHTML = offices.length + '<span class="stat-unit">ä»¶</span>';

                // å–å¼•å…ˆæ•°
                const partners = JSON.parse(localStorage.getItem('partners') || '[]');
                document.getElementById('partnerCount').innerHTML = partners.length + '<span class="stat-unit">ä»¶</span>';

                // é€šå ±æ•°
                const reports = JSON.parse(localStorage.getItem('onetouch.reports') || '[]');
                document.getElementById('reportCount').innerHTML = reports.length + '<span class="stat-unit">ä»¶</span>';
            } catch (e) {
                console.error('çµ±è¨ˆæƒ…å ±ã®å–å¾—ã«å¤±æ•—:', e);
            }
        }

        // ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
        // CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå®Ÿè¡Œ
        function executeExport() {
            try {
                const exportAccounts = document.getElementById('exportAccounts').checked;
                const exportOffices = document.getElementById('exportOffices').checked;
                const exportPartners = document.getElementById('exportPartners').checked;
                const exportItems = document.getElementById('exportItems').checked;
                const exportReports = document.getElementById('exportReports').checked;
                const exportAudit = document.getElementById('exportAudit').checked;
                
                if (!exportAccounts && !exportOffices && !exportPartners && !exportItems && !exportReports && !exportAudit) {
                    alert('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
                    return;
                }
                
                const dateStr = new Date().toISOString().split('T')[0];
                
                if (exportAccounts) {
                    let accounts = JSON.parse(demoGetFromLocalStorage('accounts') || '[]');
                    accounts = filterByScope(accounts);
                    exportToCSV(accounts, `accounts_${dateStr}.csv`, ['id', 'userId', 'name', 'companyCode', 'officeCode', 'role', 'status']);
                }
                
                if (exportOffices) {
                    let offices = JSON.parse(localStorage.getItem('offices') || '[]');
                    offices = filterByScope(offices);
                    exportToCSV(offices, `offices_${dateStr}.csv`, ['officeCode', 'officeName', 'companyCode', 'address', 'phone', 'status']);
                }
                
                if (exportPartners) {
                    let partners = JSON.parse(demoGetFromLocalStorage('partners') || '[]');
                    partners = filterByScope(partners);
                    exportToCSV(partners, `partners_${dateStr}.csv`, ['id', 'name', 'partnerCode', 'categories', 'assignedCompanies', 'contactName', 'status']);
                }
                
                if (exportItems) {
                    let items = JSON.parse(demoGetFromSessionOrLocalStorage('items') || '[]');
                    items = filterByScope(items);
                    exportToCSV(items, `items_${dateStr}.csv`, ['itemId', 'name', 'maker', 'model', 'category', 'assignedPartnerName', 'price', 'stock']);
                }
                
                if (exportReports) {
                    let reports = JSON.parse(demoGetFromLocalStorage('onetouch.reports') || '[]');
                    reports = filterByScope(reports);
                    exportToCSV(reports, `reports_${dateStr}.csv`, ['id', 'timestamp', 'category', 'title', 'priority', 'location', 'description', 'assignedPartnerName', 'contractorStatus']);
                }
                
                if (exportAudit) {
                    let logs = JSON.parse(localStorage.getItem('audit.logs') || '[]');
                    logs = filterByScope(logs);
                    exportToCSV(logs, `audit_logs_${dateStr}.csv`, ['timestamp', 'action', 'userId', 'userName', 'details']);
                }
                
                alert('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãŒå®Œäº†ã—ã¾ã—ãŸã€‚');
            } catch (e) {
                console.error('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼:', e);
                alert('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
            }
        }
        
        // ã‚¹ã‚³ãƒ¼ãƒ—ã«å¿œã˜ãŸãƒ‡ãƒ¼ã‚¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
        function filterByScope(data) {
            if (currentUser.role === 'system_admin') {
                return data; // å…¨ãƒ‡ãƒ¼ã‚¿
            } else if (currentUser.role === 'company_admin') {
                return data.filter(item => item.companyCode === currentUser.companyCode);
            } else if (currentUser.role === 'office_admin') {
                return data.filter(item => item.officeCode === currentUser.officeCode || item.companyCode === currentUser.companyCode);
            }
            return data;
        }
        
        // CSVå¤‰æ›ï¼†ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
        function exportToCSV(data, filename, columns) {
            if (!data || data.length === 0) {
                console.warn('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“:', filename);
                return;
            }
            
            // BOMä»˜ãCSVï¼ˆExcelå¯¾å¿œï¼‰
            const BOM = '\uFEFF';
            
            // ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œ
            const headers = columns.join(',');
            
            // ãƒ‡ãƒ¼ã‚¿è¡Œ
            const rows = data.map(item => {
                return columns.map(col => {
                    let value = item[col];
                    
                    // é…åˆ—ã®å ´åˆã¯ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã«å¤‰æ›
                    if (Array.isArray(value)) {
                        value = value.join(';');
                    }
                    
                    // null/undefinedã®å ´åˆã¯ç©ºæ–‡å­—
                    if (value === null || value === undefined) {
                        value = '';
                    }
                    
                    // æ–‡å­—åˆ—ã®å ´åˆã€ã‚«ãƒ³ãƒãƒ»æ”¹è¡Œãƒ»ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆã‚’ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
                    value = String(value);
                    if (value.includes(',') || value.includes('\n') || value.includes('"')) {
                        value = '"' + value.replace(/"/g, '""') + '"';
                    }
                    
                    return value;
                }).join(',');
            });
            
            const csv = BOM + headers + '\n' + rows.join('\n');
            
            // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(link.href);
        }

        // å…¨ãƒ‡ãƒ¼ã‚¿å‰Šé™¤
        function clearAllData() {
            const confirmed = confirm('æœ¬å½“ã«å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\nã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚');
            if (!confirmed) return;

            const doubleConfirm = confirm('å‰Šé™¤ã™ã‚‹ã¨ã€ä¼šç¤¾ã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã€äº‹æ¥­æ‰€ã€å–å¼•å…ˆã€é€šå ±å±¥æ­´ã®å…¨ãƒ‡ãƒ¼ã‚¿ãŒå‰Šé™¤ã•ã‚Œã¾ã™ã€‚\næœ¬å½“ã«ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ');
            if (!doubleConfirm) return;

            try {
                localStorage.removeItem('companies');
                localStorage.removeItem('accounts');
                localStorage.removeItem('offices');
                localStorage.removeItem('partners');
                localStorage.removeItem('onetouch.reports');
                localStorage.removeItem('currentAccount');
                localStorage.removeItem('audit.logs');

                alert('å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚');
                loadStats();
                
                // 3ç§’å¾Œã«ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã¸
                setTimeout(() => {
                    sessionStorage.clear();
                    localStorage.clear();
                    window.location.href = 'login.html';
                }, 3000);
            } catch (e) {
                console.error('å‰Šé™¤ã‚¨ãƒ©ãƒ¼:', e);
                alert('å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
            }
        }

        // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
        function logout() {
            const confirmed = confirm('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã™ã‹ï¼Ÿ');
            if (!confirmed) return;

            sessionStorage.removeItem('currentUser');
            localStorage.removeItem('currentAccount');
            localStorage.removeItem('ONE_loggedIn');
            localStorage.removeItem('ONE_userId');
            localStorage.removeItem('ONE_userName');
            window.location.href = 'login.html';
        }

        // ä¼šç¤¾è¨­å®šã®è¡¨ç¤ºåˆ¶å¾¡
        function initializeSettings() {
            // çµ±è¨ˆæƒ…å ±ã‚’ç”Ÿæˆ
            loadStats();
            
            if (currentUser.role === 'system_admin') {
                // ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…
                document.getElementById('dataExportSection').style.display = 'block';
                document.getElementById('dataDeleteSection').style.display = 'block';
            } else if (currentUser.role === 'company_admin') {
                // æœ¬ç¤¾ç®¡ç†è€…
                document.getElementById('companySettings').style.display = 'block';
                document.getElementById('categorySettings').style.display = 'block';
                document.getElementById('auditLogSection').style.display = 'block';
                document.getElementById('dataExportSection').style.display = 'block';
                loadCompanySettings();
                loadCustomCategories();
                // äº‹æ¥­æ‰€ç®¡ç†è€…ã«ã¯è¦‹ã›ãªã„ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’éè¡¨ç¤º
                document.getElementById('exportPartnersLabel').style.display = 'none';
            } else if (currentUser.role === 'office_admin') {
                // äº‹æ¥­æ‰€ç®¡ç†è€…
                document.getElementById('officeInfo').style.display = 'block';
                document.getElementById('auditLogSection').style.display = 'block';
                document.getElementById('dataExportSection').style.display = 'block';
                loadOfficeInfo();
                // äº‹æ¥­æ‰€ç®¡ç†è€…ã«ã¯è¦‹ã›ãªã„ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’éè¡¨ç¤º
                document.getElementById('exportOfficesLabel').style.display = 'none';
                document.getElementById('exportPartnersLabel').style.display = 'none';
                document.getElementById('exportAuditLabel').style.display = 'none';
            }
        }

        // çµ±è¨ˆæƒ…å ±ã‚’èª­ã¿è¾¼ã¿
        function loadStats() {
            const statsGrid = document.getElementById('statsGrid');
            statsGrid.innerHTML = '';
            
            try {
                if (currentUser.role === 'system_admin') {
                    // ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…: å…¨ä½“ã®çµ±è¨ˆ
                    const companies = JSON.parse(localStorage.getItem('companies') || '[]');
                    const offices = JSON.parse(localStorage.getItem('offices') || '[]');
                    const accounts = JSON.parse(demoGetFromLocalStorage('accounts') || '[]');
                    const partners = JSON.parse(demoGetFromLocalStorage('partners') || '[]');
                    const reports = JSON.parse(demoGetFromLocalStorage('onetouch.reports') || '[]');
                    
                    statsGrid.innerHTML = `
                        <div class="stat-card">
                            <div class="stat-label">ç™»éŒ²ä¼šç¤¾æ•°</div>
                            <div class="stat-value">${companies.length}<span class="stat-unit">ç¤¾</span></div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">ç™»éŒ²äº‹æ¥­æ‰€æ•°</div>
                            <div class="stat-value">${offices.length}<span class="stat-unit">ç®‡æ‰€</span></div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">ç™»éŒ²ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæ•°</div>
                            <div class="stat-value">${accounts.length}<span class="stat-unit">ä»¶</span></div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">ç™»éŒ²æ¥­è€…æ•°</div>
                            <div class="stat-value">${partners.length}<span class="stat-unit">ç¤¾</span></div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">ç·é€šå ±æ•°</div>
                            <div class="stat-value">${reports.length}<span class="stat-unit">ä»¶</span></div>
                        </div>
                    `;
                } else if (currentUser.role === 'company_admin') {
                    // æœ¬ç¤¾ç®¡ç†è€…: è‡ªç¤¾ã®çµ±è¨ˆ
                    const offices = JSON.parse(localStorage.getItem('offices') || '[]').filter(o => o.companyCode === currentUser.companyCode);
                    const accounts = JSON.parse(demoGetFromLocalStorage('accounts') || '[]').filter(a => a.companyCode === currentUser.companyCode);
                    const partners = JSON.parse(demoGetFromLocalStorage('partners') || '[]').filter(p => p.assignedCompanies && p.assignedCompanies.includes(currentUser.companyCode));
                    const reports = JSON.parse(demoGetFromLocalStorage('onetouch.reports') || '[]').filter(r => r.companyCode === currentUser.companyCode);
                    const items = JSON.parse(demoGetFromSessionOrLocalStorage('items') || '[]').filter(i => i.companyCode === currentUser.companyCode);
                    
                    statsGrid.innerHTML = `
                        <div class="stat-card">
                            <div class="stat-label">ç™»éŒ²äº‹æ¥­æ‰€æ•°</div>
                            <div class="stat-value">${offices.length}<span class="stat-unit">ç®‡æ‰€</span></div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">ç™»éŒ²ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæ•°</div>
                            <div class="stat-value">${accounts.length}<span class="stat-unit">ä»¶</span></div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">å¥‘ç´„æ¥­è€…æ•°</div>
                            <div class="stat-value">${partners.length}<span class="stat-unit">ç¤¾</span></div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">ç™»éŒ²å•†å“æ•°</div>
                            <div class="stat-value">${items.length}<span class="stat-unit">ä»¶</span></div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">ç·é€šå ±æ•°</div>
                            <div class="stat-value">${reports.length}<span class="stat-unit">ä»¶</span></div>
                        </div>
                    `;
                } else if (currentUser.role === 'office_admin') {
                    // äº‹æ¥­æ‰€ç®¡ç†è€…: è‡ªäº‹æ¥­æ‰€ã®çµ±è¨ˆ
                    const accounts = JSON.parse(demoGetFromLocalStorage('accounts') || '[]').filter(a => a.officeCode === currentUser.officeCode);
                    const reports = JSON.parse(demoGetFromLocalStorage('onetouch.reports') || '[]').filter(r => r.officeCode === currentUser.officeCode);
                    const items = JSON.parse(demoGetFromSessionOrLocalStorage('items') || '[]').filter(i => i.officeCode === currentUser.officeCode);
                    
                    statsGrid.innerHTML = `
                        <div class="stat-card">
                            <div class="stat-label">ç™»éŒ²ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæ•°</div>
                            <div class="stat-value">${accounts.length}<span class="stat-unit">ä»¶</span></div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">ç™»éŒ²å•†å“æ•°</div>
                            <div class="stat-value">${items.length}<span class="stat-unit">ä»¶</span></div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">ç·é€šå ±æ•°</div>
                            <div class="stat-value">${reports.length}<span class="stat-unit">ä»¶</span></div>
                        </div>
                    `;
                }
            } catch (e) {
                console.error('çµ±è¨ˆæƒ…å ±ã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', e);
            }
        }
        
        // sessionStorage/localStorageåˆ‡ã‚Šæ›¿ãˆå¯¾å¿œ
        function demoGetFromSessionOrLocalStorage(key) {
            const isDemoMode = currentUser && currentUser.companyCode === 'TAMJ';
            if (isDemoMode) {
                const demoKey = 'demo.' + key;
                return sessionStorage.getItem(demoKey) || localStorage.getItem(key);
            }
            return localStorage.getItem(key);
        }

        // äº‹æ¥­æ‰€æƒ…å ±ã‚’èª­ã¿è¾¼ã¿
        function loadOfficeInfo() {
            try {
                // DEMOãƒ¢ãƒ¼ãƒ‰ã®å ´åˆ
                if (currentUser.companyCode === 'TAMJ') {
                    document.getElementById('officeNameDisplay').textContent = currentUser.officeName || 'æ±äº¬äº‹æ¥­æ‰€';
                    document.getElementById('officeCodeDisplay').textContent = currentUser.officeCode || 'TAMJ-J0001';
                    document.getElementById('officeCompanyDisplay').textContent = 'ã‚¿ãƒ ã‚¸æ ªå¼ä¼šç¤¾';
                    document.getElementById('officeAddressDisplay').textContent = 'æ±äº¬éƒ½æ¸‹è°·åŒº1-2-3';
                    document.getElementById('officePhoneDisplay').textContent = '03-1234-5678';
                    return;
                }
                
                // é€šå¸¸ãƒ¢ãƒ¼ãƒ‰: äº‹æ¥­æ‰€ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
                const offices = JSON.parse(localStorage.getItem('offices') || '[]');
                const office = offices.find(o => o.officeCode === currentUser.officeCode);
                
                if (office) {
                    document.getElementById('officeNameDisplay').textContent = office.officeName || '-';
                    document.getElementById('officeCodeDisplay').textContent = office.officeCode || '-';
                    document.getElementById('officeCompanyDisplay').textContent = office.companyName || currentUser.companyName || '-';
                    document.getElementById('officeAddressDisplay').textContent = office.address || '-';
                    document.getElementById('officePhoneDisplay').textContent = office.phone || '-';
                } else {
                    console.warn('äº‹æ¥­æ‰€æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“:', currentUser.officeCode);
                }
            } catch (e) {
                console.error('äº‹æ¥­æ‰€æƒ…å ±ã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', e);
            }
        }

        // ä¼šç¤¾è¨­å®šã‚’èª­ã¿è¾¼ã¿
        function loadCompanySettings() {
            // DEMOãƒ¢ãƒ¼ãƒ‰ã®å ´åˆ
            if (currentUser.companyCode === 'TAMJ') {
                document.getElementById('companyNameDisplay').textContent = 'ã‚¿ãƒ ã‚¸æ ªå¼ä¼šç¤¾';
                document.getElementById('companyCodeDisplay').textContent = 'TAMJ';
                
                // DEMOãƒ¢ãƒ¼ãƒ‰ã®ãƒ­ã‚´ã‚’è¡¨ç¤º
                const demoLogo = sessionStorage.getItem('demo.companyLogo');
                if (demoLogo) {
                    document.getElementById('currentLogo').innerHTML = `<img src="${demoLogo}" style="width:100%; height:100%; object-fit:cover; border-radius:8px;">`;
                }
                return;
            }
            
            // é€šå¸¸ãƒ¢ãƒ¼ãƒ‰
            const companies = JSON.parse(localStorage.getItem('companies') || '[]');
            const company = companies.find(c => c.code === currentUser.companyCode);
            
            if (company) {
                document.getElementById('companyNameDisplay').textContent = company.name;
                document.getElementById('companyCodeDisplay').textContent = company.code;
                
                // ãƒ­ã‚´ãŒã‚ã‚Œã°è¡¨ç¤º
                if (company.logoUrl) {
                    document.getElementById('currentLogo').innerHTML = `<img src="${company.logoUrl}" style="width:100%; height:100%; object-fit:cover; border-radius:8px;">`;
                }
            }
        }

        // ãƒ­ã‚´ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å‡¦ç†
        function handleLogoUpload(event) {
            console.log('[handleLogoUpload] é–‹å§‹');
            const file = event.target.files[0];
            if (!file) {
                console.log('[handleLogoUpload] ãƒ•ã‚¡ã‚¤ãƒ«ãªã—');
                return;
            }
            
            console.log('[handleLogoUpload] ãƒ•ã‚¡ã‚¤ãƒ«å:', file.name);
            console.log('[handleLogoUpload] ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º:', file.size);
            console.log('[handleLogoUpload] ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—:', file.type);

            // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãƒã‚§ãƒƒã‚¯ï¼ˆ2MBä»¥ä¸‹ï¼‰
            if (file.size > 2 * 1024 * 1024) {
                alert('ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã¯2MBä»¥ä¸‹ã«ã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            // ç”»åƒå½¢å¼ãƒã‚§ãƒƒã‚¯
            if (!file.type.startsWith('image/')) {
                alert('ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            console.log('[handleLogoUpload] FileReaderé–‹å§‹');
            const reader = new FileReader();
            reader.onload = function(e) {
                console.log('[handleLogoUpload] FileReaderå®Œäº†');
                const logoUrl = e.target.result;
                console.log('[handleLogoUpload] logoUrlé•·ã•:', logoUrl.length);
                
                // DEMOãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã¯sessionStorageã«ä¿å­˜
                if (currentUser.companyCode === 'TAMJ') {
                    sessionStorage.setItem('demo.companyLogo', logoUrl);
                    document.getElementById('currentLogo').innerHTML = `<img src="${logoUrl}" style="width:100%; height:100%; object-fit:cover; border-radius:8px;">`;
                    // ãƒ˜ãƒƒãƒ€ãƒ¼ã‚¢ãƒã‚¿ãƒ¼ã‚‚å³æ™‚æ›´æ–°
                    const uhAvatar = document.getElementById('uhAvatar');
                    if (uhAvatar) { uhAvatar.style.background='white'; uhAvatar.style.boxShadow='0 0 0 1px #e0e0e0'; uhAvatar.style.padding='3px'; uhAvatar.innerHTML = `<img src="${logoUrl}" style="width:100%;height:100%;object-fit:contain;border-radius:50%;">`; }
                    alert('ãƒ­ã‚´ã‚’æ›´æ–°ã—ã¾ã—ãŸã€‚\n\nâ€» DEMOãƒ¢ãƒ¼ãƒ‰ã®ãŸã‚ã€ãƒ–ãƒ©ã‚¦ã‚¶ã‚’é–‰ã˜ã‚‹ã¨å‰Šé™¤ã•ã‚Œã¾ã™ã€‚');
                    return;
                }
                
                // é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ï¼šlocalStorageã«ä¿å­˜
                const companies = JSON.parse(localStorage.getItem('companies') || '[]');
                console.log('[handleLogoUpload] companiesæ•°:', companies.length);
                console.log('[handleLogoUpload] currentUser.companyCode:', currentUser.companyCode);
                
                const companyIndex = companies.findIndex(c => c.code === currentUser.companyCode);
                console.log('[handleLogoUpload] companyIndex:', companyIndex);
                
                if (companyIndex !== -1) {
                    companies[companyIndex].logoUrl = logoUrl;
                    localStorage.setItem('companies', JSON.stringify(companies));
                    console.log('[handleLogoUpload] localStorageæ›´æ–°å®Œäº†');
                    
                    // è¡¨ç¤ºã‚’æ›´æ–°
                    document.getElementById('currentLogo').innerHTML = `<img src="${logoUrl}" style="width:100%; height:100%; object-fit:cover; border-radius:8px;">`;
                    // ãƒ˜ãƒƒãƒ€ãƒ¼ã‚¢ãƒã‚¿ãƒ¼ã‚‚å³æ™‚æ›´æ–°
                    const uhAvatar = document.getElementById('uhAvatar');
                    if (uhAvatar) { uhAvatar.style.background='white'; uhAvatar.style.boxShadow='0 0 0 1px #e0e0e0'; uhAvatar.style.padding='3px'; uhAvatar.innerHTML = `<img src="${logoUrl}" style="width:100%;height:100%;object-fit:contain;border-radius:50%;">`; }
                    console.log('[handleLogoUpload] è¡¨ç¤ºæ›´æ–°å®Œäº†');
                    
                    alert('ãƒ­ã‚´ã‚’æ›´æ–°ã—ã¾ã—ãŸã€‚');
                } else {
                    console.error('[handleLogoUpload] ä¼šç¤¾ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    alert('ã‚¨ãƒ©ãƒ¼: ä¼šç¤¾æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚\ncompanyCode: ' + currentUser.companyCode);
                }
            };
            
            reader.onerror = function(error) {
                console.error('[handleLogoUpload] FileReaderã‚¨ãƒ©ãƒ¼:', error);
                alert('ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
            };
            
            reader.readAsDataURL(file);
            console.log('[handleLogoUpload] readAsDataURLå®Ÿè¡Œ');
        }

        // ã‚«ã‚¹ã‚¿ãƒ ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’èª­ã¿è¾¼ã¿
        function loadCustomCategories() {
            const categories = JSON.parse(localStorage.getItem('customCategories') || '{}');
            const companyCategories = categories[currentUser.companyCode] || [];
            
            const container = document.getElementById('customCategoriesList');
            container.innerHTML = '';
            
            if (companyCategories.length === 0) {
                container.innerHTML = '<div style="color: #999; font-size: 14px;">ã‚«ã‚¹ã‚¿ãƒ ã‚«ãƒ†ã‚´ãƒªãƒ¼ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“</div>';
                return;
            }
            
            companyCategories.forEach((category, index) => {
                const badge = document.createElement('span');
                badge.className = 'badge';
                badge.style.background = '#f5f5f5';
                badge.style.color = '#333';
                badge.style.display = 'inline-flex';
                badge.style.alignItems = 'center';
                badge.style.gap = '8px';
                badge.innerHTML = `
                    ${category}
                    <button onclick="deleteCustomCategory(${index})" style="background:none; border:none; cursor:pointer; color:#c62828; font-size:16px; padding:0; line-height:1;">Ã—</button>
                `;
                container.appendChild(badge);
            });
        }

        // ã‚«ã‚¹ã‚¿ãƒ ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’è¿½åŠ 
        function addCustomCategory() {
            const categoryName = prompt('ã‚«ãƒ†ã‚´ãƒªãƒ¼åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:');
            if (!categoryName || categoryName.trim() === '') return;
            
            const categories = JSON.parse(localStorage.getItem('customCategories') || '{}');
            if (!categories[currentUser.companyCode]) {
                categories[currentUser.companyCode] = [];
            }
            
            // é‡è¤‡ãƒã‚§ãƒƒã‚¯
            if (categories[currentUser.companyCode].includes(categoryName.trim())) {
                alert('åŒã˜åå‰ã®ã‚«ãƒ†ã‚´ãƒªãƒ¼ãŒæ—¢ã«å­˜åœ¨ã—ã¾ã™ã€‚');
                return;
            }
            
            categories[currentUser.companyCode].push(categoryName.trim());
            localStorage.setItem('customCategories', JSON.stringify(categories));
            
            loadCustomCategories();
            alert('ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚');
        }

        // ã‚«ã‚¹ã‚¿ãƒ ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’å‰Šé™¤
        function deleteCustomCategory(index) {
            const confirmed = confirm('ã“ã®ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ');
            if (!confirmed) return;
            
            const categories = JSON.parse(localStorage.getItem('customCategories') || '{}');
            if (categories[currentUser.companyCode]) {
                categories[currentUser.companyCode].splice(index, 1);
                localStorage.setItem('customCategories', JSON.stringify(categories));
                loadCustomCategories();
                alert('ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚');
            }
        }

        // åˆæœŸåŒ–
        loadStats();
        initializeSettings();
        if (currentUser.role === 'system_admin') {
            calculateAdvancedStats();
        }
    </script>

    <script>
    // çµ±ä¸€ãƒ˜ãƒƒãƒ€ãƒ¼åˆæœŸåŒ–
    UnifiedHeader.init({
        icon: '',
        title: 'ã‚·ã‚¹ãƒ†ãƒ è¨­å®š',
        backButton: true
    });
    </script>
</body>
</html>
